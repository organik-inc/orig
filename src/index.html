<!doctype html>
<!-- oRig - Built for LFG at ETH Global Hackathon. March 22. -->
<html lang="en">
    
<head>
    <title>oRig DAO</title>
    <link href="bootstrap.css" rel="stylesheet" id="style">
</head>

<body class="body-scroll d-flex flex-column h-100 dark-bg" data-page="dapp" onload="">

<div class="container-fluid loader-wrap">
    <div class="row h-100">
        <div class="col-10 col-md-6 col-lg-5 col-xl-3 mx-auto text-center align-self-center">
            <div class="loader-cube-wrap mx-auto">
                <div class="loader-cube1 loader-cube"></div>
                <div class="loader-cube2 loader-cube"></div>
                <div class="loader-cube4 loader-cube"></div>
                <div class="loader-cube3 loader-cube"></div>
            </div>
            <p>Loading!<br><strong>One Moment Please</strong></p>
        </div>
    </div>
</div>

<main class="container-fluid h-100">
    <div class="row h-100 splash">
        <div class="col-10 col-md-6 col-lg-5 col-xl-3 mx-auto mt-auto text-center mb-100px d-grid gap-2">
            <h3 id="text" class="mb-1 splash">Welcome to</h3>
            <p class="text-muted mb-4 splash"><small>ORIG DAO</small></p>
            
            <a href="#" target="_self" id="btn-login" class="btn btn-lg btn-default btn-block shadow-sm MetaMaskConnect">
                <img alt="MetaMaskLogo" src="./img/metamask-fox-logo.svg" class="" style="max-width:35px;" />
                Connect</a>
                
            <a href="#" target="_self" id="InstallMetaMask" class="btn btn-lg btn-default btn-block shadow-sm InstallMetaMask">
            <img alt="MetaMaskLogo" src="./img/metamask-fox-logo.svg" class="" style="max-width:35px;" />
            Install</a>
            <a href="./" id="launch" class="btn btn-lg btn-default btn-block shadow-sm">ENTER</a>
            
            <a href="#" target="_self" id="btn-logout" class="btn btn-lg btn-default btn-block shadow-sm MetaMaskConnect" style="background-color: #fb73dd;">
            <img alt="MetaMaskLogo" src="./img/metamask-fox-logo.svg" class="" style="max-width:35px;" />
            Disconnect</a>
            
            <a href="#" target="_self" class="text-white btn btn-lg btn-link splash">Terms of Service</a>
            
        </div>
    </div>
    
    <div id="dapp" class="row h-100">
        <div class="col-10 col-md-6 col-lg-5 col-xl-3 mx-auto mt-auto text-center mb-100px d-grid gap-2">
            
            <p id="showAccount" class="text-muted mb-2 showAccount"><small>ORGANIK DAO</small></p>
            <p id="balance" class="text-muted mb-4"><small>ORIG DAO</small></p>

            <p id="slogan" class="text-muted mb-4"><small>ORIG DAO</small></p>
            <a href="#" id="getProfiles" class="btn btn-lg btn-default btn-block shadow-sm">LOGIN WITH LENS</a>
            <a href="#" target="_self" class="text-white btn btn-lg btn-link">Join Discord</a>
        </div>
    </div>

</main>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://unpkg.com/moralis@1.5.5/dist/moralis.js"></script>
<script src="js/moralisKeys.js"></script>
<script>
    'use strict'
    const daoAddress = ''; // In case we need a SC to interact with.
    // This Address is only for Polygon's Mumbai Testnet.
    var walletAddress = '';
    
    $(document).ready(function () {
        $('#btn-login').hide();
        $('#btn-logout').hide();
        $('#launch').hide();
        $('#InstallMetaMask').hide();
        $('#dapp').hide();
        
        // Edit the file "js/moralisKeys.js" with your own Moralis App Keys (https://moralis.io)
        const serverUrl = moralisKeys.serverUrl;
        const appId =  moralisKeys.appId;
        
        Moralis.start({ serverUrl, appId });
        
        ethereum.on('accountsChanged', (accounts) => {
        console.log(account)
        // Handle the new accounts, or lack thereof.
        // "accounts" will always be an array, but it can be empty.
        window.location.reload();
        });

        ethereum.on('chainChanged', (chainId) => {
        const chain = parseInt(chainId.replace("0x","").toString(16), 16)
        console.log(chainId, chain);
        if(chain !== 80001){
            alert('Please connect to Polygon Mumbai Network')
        }else{
            window.location.reload();
        }
        // Handle the new chain.
        // Correctly handling chain changes can be complicated.
        // We recommend reloading the page unless you have good reason not to.
        // window.location.reload();
        });

        async function login() {
          $('.loader-wrap').fadeIn('slow');
          let user = Moralis.User.current();
            if (!user) {
              user = await Moralis.authenticate({ signingMessage: "oRig DAO is requesting your signature to approve login authorization!\n\nYou will NOT be charged for this interaction." })
                .then(function (user) {
                  console.log("logged in user:", user);
                  walletAddress = user.get("ethAddress");
                  console.log(walletAddress);
                  $('#btn-login').hide();
                  $('#btn-logout').show();
                  $('#launch').show();
                })
                .catch(function (error) {
                  console.log(error);
                });
            }else{
                console.log("logged in user:", user);
                walletAddress = user.get("ethAddress");
                console.log(walletAddress);
                $('#btn-login').hide();
                $('#btn-logout').show();
            }
            setTimeout(function () {
                $('.loader-wrap').fadeOut('slow');
            }, 999);
        }
        
        async function logOut() {
            $('.loader-wrap').fadeIn('slow');
            await Moralis.User.logOut();
            setTimeout(function () {
                  console.log("logged out");
                  $('#btn-login').show();
                  $('#btn-logout').hide();
                  $('#launch').hide();
                  $('.loader-wrap').fadeOut('slow');
            }, 999);
        }

        async function launchDapp(event) {
          event.preventDefault();
          const miniAddress = walletAddress.replace(walletAddress.substring(6, 38), '...')
          console.log("launchDapp");
          $('.loader-wrap').fadeIn('slow');
          const balance  = await ethereum.request({ method: 'eth_getBalance' , params: [ walletAddress, 'latest' ]})
          const network = 0;
          // // Returns a hex value of Wei
          const wei = parseInt(balance, 16)
          const gwei = (wei / Math.pow(10, 9)) // parse to Gwei
          const eth = (wei / Math.pow(10, 18))// parse to ETH
          
          // console.log(wei,gwei,eth, balance)
          $('.showAccount').show();
          $('.showAccount').text(`Polygon: ${miniAddress}`);
          
          $('#balance').show();
          $('#balance').text(`BALANCE: ${eth} MATIC`);
          
          setTimeout(function () {
                $('.splash').hide();
                $('#dapp').show();
                $('#launch').hide();
                $('#btn-logout').hide();
                $('.loader-wrap').fadeOut('slow');
              }, 999);
        }

        async function getProfiles(event) {
            console.log('Work in progress')
        }
        
        document.getElementById("btn-login").onclick = login;
        document.getElementById("btn-logout").onclick = logOut;
        document.getElementById("launch").onclick = launchDapp;
        document.getElementById("getProfiles").onclick = getProfiles;

        let user = Moralis.User.current();
          if (!user) {
              console.log('not logged in')
              $('#btn-login').show();
              $('#btn-logout').hide();
          }else{
              $('.loader-wrap').fadeIn('slow');
              walletAddress = user.get("ethAddress");
              console.log(walletAddress);
              setTimeout(function () {
                    console.log('Logged in', user)
                    $('#launch').show();
                    $('#btn-logout').show();
              }, 999);
          }
        
    })
</script>
<script>
    'use strict'
    $(document).ready(function () {
        
        var body = $('body');
        var bodyParent = $('html');
    
        /* page load as iframe */
        if (self !== top) {
            body.addClass('iframe');
        } else {
            body.removeClass('iframe');
        }
    
        /* menu open close */
        $('.menu-btn').on('click', function () {
            if (body.hasClass('menu-open') === true) {
                body.removeClass('menu-open');
                bodyParent.removeClass('menu-open');
            } else {
                body.addClass('menu-open');
                bodyParent.addClass('menu-open');
            }
    
            return false;
        });
    
        body.on("click", function (e) {
            if (!$('.sidebar').is(e.target) && $('.sidebar').has(e.target).length === 0) {
                body.removeClass('menu-open');
                bodyParent.removeClass('menu-open');
            }
    
            return true;
        });
    
    
    
        /* menu style switch */
        $('#menu-pushcontent').on('change', function () {
            if ($(this).is(':checked') === true) {
                body.addClass('menu-push-content');
                body.removeClass('menu-overlay');
            }
    
            return false;
        });
        $('#menu-overlay').on('change', function () {
            if ($(this).is(':checked') === true) {
                body.removeClass('menu-push-content');
                body.addClass('menu-overlay');
            }
    
            return false;
        });
    
    
        /* back page navigation */
        $('.back-btn').on('click', function () {
            window.history.back();
    
            return false;
        });
    
        /* Filter button */
        $('.filter-btn').on('click', function () {
            if (body.hasClass('filter-open') === true) {
                body.removeClass('filter-open');
            } else {
                body.addClass('filter-open');
            }
    
            return false;
        });
        $('.filter-close').on('click', function () {
            if (body.hasClass('filter-open') === true) {
                body.removeClass('filter-open');
            }
        });
    
        /* scroll y limited container height on page  */
        var scrollyheight = Number($(window).height() - $('.header').outerHeight() - $('.footer-info').outerHeight()) - 40;
        $('.scroll-y').height(scrollyheight);
    
    });
    
    
    $(window).on('load', function () {
        setTimeout(function () {
            $('.loader-wrap').fadeOut('slow');
        }, 500);
    
        /* coverimg */
        $('.coverimg').each(function () {
            var imgpath = $(this).find('img');
            $(this).css('background-image', 'url(' + imgpath.attr('src') + ')');
            imgpath.hide();
        })
    
        /* main container minimum height set */
        if ($('.header').length > 0 && $('.footer-info').length > 0) {
            var heightheader = $('.header').outerHeight();
            var heightfooter = $('.footer-info').outerHeight();
    
            var containerheight = $(window).height() - heightheader - heightfooter - 2;
            $('.main-container ').css('min-height', containerheight);
        }
    
    
        /* url path on menu */
        var path = window.location.href; // because the 'href' property of the DOM element is the absolute path
        $(' .main-menu ul a').each(function () {
            if (this.href === path) {
                $(' .main-menu ul a').removeClass('active');
                $(this).addClass('active');
            }
        });
    
    });
    
    $(window).on('scroll', function () {
    
    
        /* scroll from top and add class */
        if ($(document).scrollTop() > '10') {
            $('.header').addClass('active');
        } else {
            $('.header').removeClass('active');
        }
    });
    
    
    $(window).on('resize', function () {
        /* main container minimum height set */
        if ($('.header').length > 0 && $('.footer-info').length > 0) {
            var heightheader = $('.header').outerHeight();
            var heightfooter = $('.footer-info').outerHeight();
            var containerheight = $(window).height() - heightheader - heightfooter;
            $('.main-container ').css('min-height', containerheight);
        }
    });
</script>
<script>
    'use strict';
    $(window).on('load', function () {
    
        var body = $('body');
    
        switch (body.attr('data-page')) {
            
            case "dapp":
                console.log("Welcome to oRig DAO")	
            break;
        }
    
    });
</script>

</body>
</html>